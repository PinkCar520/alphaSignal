# 基金关注列表新功能测试指南

## 快速测试步骤

### 测试 1: 关注列表排序功能 📊

#### 步骤
1. 打开基金页面 `/funds`
2. 等待页面加载完成（约 1-2 秒）
3. 观察左侧关注列表

#### 预期结果
- ✅ 列表中的基金会自动按涨跌幅排序
- ✅ 涨幅最高的基金排在最前面
- ✅ 每个基金名称右侧显示涨跌幅百分比
- ✅ 涨幅用**红色**显示（例如：+2.35%）
- ✅ 跌幅用**绿色**显示（例如：-0.87%）

#### 示例显示
```
┌─────────────────────────────────┐
│ 永赢科技智选混合C      +2.35%  │ ← 涨幅最高（红色）
│ 022365                          │
├─────────────────────────────────┤
│ 南方中证半导体C        -0.87%  │ ← 跌幅（绿色）
│ 020840                          │
└─────────────────────────────────┘
```

#### 验证排序逻辑
1. 切换到第二个基金
2. 等待数据加载
3. 切换回第一个基金
4. 观察列表是否重新排序

---

### 测试 2: 刷新按钮动画 🔄

#### 步骤
1. 选择任意基金，等待数据加载完成
2. 观察右上角的刷新按钮（RefreshCw 图标）
3. **点击刷新按钮**
4. 观察动画效果

#### 预期结果
- ✅ 点击后，按钮**立即开始旋转**
- ✅ 旋转动画持续至少 **600ms**（即使数据加载很快）
- ✅ 旋转期间按钮变为**半透明**（disabled 状态）
- ✅ 旋转期间**无法再次点击**
- ✅ 动画结束后，按钮恢复正常状态
- ✅ 数据更新，`lastUpdated` 时间改变

#### 视觉效果
```
点击前: [🔄] ← 静止
点击后: [⟳]  ← 旋转中（至少 600ms）
完成后: [🔄] ← 恢复静止
```

---

### 测试 3: 数据预加载 ⚡

#### 步骤
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 刷新页面
4. 观察 Console 输出

#### 预期结果
- ✅ 页面加载后 **1 秒**，开始预加载关注列表中的基金
- ✅ Console 中会看到类似输出：
  ```
  [Cache Hit] Using cached data for 022365
  [Cache Hit] Using cached data for 020840
  ```
- ✅ 或者看到新的 API 请求（如果缓存过期）
- ✅ 预加载不会阻塞 UI，用户可以正常操作

#### Network 标签验证
1. 切换到 Network 标签
2. 刷新页面
3. 观察 API 请求

**预期**:
- 首先加载当前选中的基金（立即）
- 1 秒后，陆续加载其他基金（每个间隔 200ms）

---

### 测试 4: 添加新基金 ➕

#### 步骤
1. 在关注列表底部的输入框中输入新基金代码（例如：`000001`）
2. 按 **Enter** 键
3. 观察列表变化

#### 预期结果
- ✅ 新基金立即添加到列表
- ✅ 自动切换到新添加的基金
- ✅ 开始加载该基金的估值数据
- ✅ 数据加载完成后，列表**自动重新排序**
- ✅ 新基金会根据其涨跌幅插入到正确的位置

---

### 测试 5: 删除基金 ❌

#### 步骤
1. 将鼠标悬停在任意基金上
2. 点击右侧的 **X** 按钮
3. 观察列表变化

#### 预期结果
- ✅ 基金立即从列表中移除
- ✅ 如果删除的是当前选中的基金，自动切换到列表中的第一个基金
- ✅ 列表重新排序（如果需要）

---

## 性能测试

### 测试 6: 快速切换基金

#### 步骤
1. 在关注列表中快速来回切换基金
2. 观察加载速度和动画流畅度

#### 预期结果
- ✅ 首次切换：正常加载（~2 秒）
- ✅ 再次切换回来：**瞬间显示**（< 10ms，缓存命中）
- ✅ 列表排序保持正确
- ✅ 涨跌幅数据正确显示

---

### 测试 7: 刷新动画最小时长

#### 步骤
1. 选择一个已经加载过的基金（缓存中有数据）
2. 点击刷新按钮
3. 观察动画持续时间

#### 预期结果
- ✅ 即使数据从缓存中立即获取，动画也会持续 **600ms**
- ✅ 这确保用户能清楚地看到刷新操作

---

## 边界情况测试

### 测试 8: 无涨跌幅数据

#### 步骤
1. 添加一个新基金（刚添加时没有涨跌幅数据）
2. 观察列表排序

#### 预期结果
- ✅ 新基金排在列表**最后**（因为没有 `estimated_growth` 数据）
- ✅ 数据加载完成后，自动移动到正确位置

---

### 测试 9: 网络错误

#### 步骤
1. 打开开发者工具
2. 切换到 Network 标签
3. 启用 "Offline" 模式
4. 点击刷新按钮

#### 预期结果
- ✅ 刷新按钮旋转 600ms 后停止
- ✅ Console 中显示错误信息
- ✅ UI 不会崩溃
- ✅ 用户可以继续操作

---

## 视觉检查清单

### UI 元素检查
- [ ] 关注列表中每个基金都显示涨跌幅（如果有数据）
- [ ] 涨幅用红色显示（`text-rose-400`）
- [ ] 跌幅用绿色显示（`text-emerald-400`）
- [ ] 刷新按钮在旋转时流畅无卡顿
- [ ] 列表排序正确（降序）
- [ ] 选中的基金有紫色高亮背景
- [ ] 删除按钮悬停时变为红色

### 动画检查
- [ ] 刷新按钮旋转动画流畅
- [ ] 旋转至少持续 600ms
- [ ] 列表排序变化时有平滑过渡（如果有 CSS transition）

### 响应式检查
- [ ] 在移动设备上，涨跌幅显示不会换行
- [ ] 在小屏幕上，基金名称会正确截断（truncate）
- [ ] 刷新按钮在所有屏幕尺寸下都可点击

---

## 常见问题排查

### 问题 1: 列表没有排序
**检查**:
1. 打开 Console，查看是否有错误
2. 确认基金数据中包含 `estimated_growth` 字段
3. 尝试手动刷新页面

### 问题 2: 刷新按钮不旋转
**检查**:
1. 确认 `refreshing` 状态是否正确更新
2. 检查 CSS 类 `animate-spin` 是否正确应用
3. 查看是否有 CSS 冲突

### 问题 3: 涨跌幅不显示
**检查**:
1. 确认 API 返回的数据中包含 `estimated_growth`
2. 检查 `fetchValuation` 是否正确更新 watchlist
3. 查看 Console 是否有错误

### 问题 4: 预加载不工作
**检查**:
1. 确认 `useEffect` 的依赖数组是否正确（应该是 `[]`）
2. 检查 1 秒延迟是否正常
3. 查看 Network 标签，确认是否有 API 请求

---

## 性能基准

| 操作 | 预期时间 |
|------|----------|
| 首次加载基金 | < 2000ms |
| 切换到已缓存基金 | < 10ms |
| 刷新按钮动画 | 600ms |
| 预加载单个基金 | < 500ms |
| 列表排序更新 | < 50ms |

---

## 成功标准

所有以下条件都满足，则测试通过：

- ✅ 关注列表按涨跌幅正确排序
- ✅ 涨跌幅颜色编码正确（红涨绿跌）
- ✅ 刷新按钮动画流畅且持续至少 600ms
- ✅ 预加载功能正常工作
- ✅ 无 Console 错误
- ✅ UI 响应流畅，无卡顿
- ✅ 所有边界情况处理正确
