# ALPHA 基金模块详细开发与测试需求文档 (v1.0)

## 1. 模块概述
ALPHA 基金模块是 AlphaSignal iOS 客户端的核心交易辅助工具。其目标是通过实时估算技术解决基金净值滞后的痛点，并结合统计学异常检测（2σ）与地缘政治情报，为专业投资者提供一个“透明、实时、可解释”的基金精算终端。

---

## 2. 功能性需求 (Functional Requirements)

### 2.1 实时净值估算引擎 (Intraday Estimation Engine)
*   **需求描述**：系统必须实时计算基金在交易时段内的推算净值。
*   **关键特性**：
    *   **高频跳动**：支持 1-5 秒级别的数值更新（基于底层资产 SSE 流）。
    *   **闪烁动画**：数值更新时，背景需触发 150ms 的琥珀色高光闪烁（Ticker Flicker）。
    *   **推算标识**：数值旁必须常驻 `Est.` (Estimated) 或 `Live` 动态脉冲图标，明确区分官方净值。
    *   **物理感知**：涨跌幅变动超过 ±0.2% 时，调用 Taptic Engine 触发轻量级触感反馈。

### 2.2 持仓穿透与情报关联 (Portfolio Penetration & Intelligence Link)
*   **需求描述**：提供从基金到个股/资产的无缝下钻能力，并自动关联地缘政治情报。
*   **关键特性**：
    *   **分层展开**：点击基金卡片，利用 `matchedGeometryEffect` 展开持仓详情。
    *   **资产映射**：持仓列表中的资产（如：AU2406, SPY ETF）需自动匹配系统情报库的 Tags。
    *   **情报注入**：详情页底部自动流式加载关联的黄金/地缘政治情报卡片（评分 > 7.0）。
    *   **穿透逻辑**：支持显示前十大重仓股的实时表现及其对总基金净值的贡献度（Contribution per Asset）。

### 2.3 统计学智能波动报警 (2σ Smart Alarm)
*   **需求描述**：基于历史波动率自动配置的异常波动预警系统。
*   **关键特性**：
    *   **默认阈值**：系统根据过去 30 日日收益率计算标准差 ($\sigma$)，默认报警线设为 $2\sigma$（约 95% 置信区间外）。
    *   **动态滑块**：用户设置页面展示 $\sigma$ 带状分布图，滑块自动定位在 $2\sigma$。
    *   **紧急推送 (Critical Alerts)**：当盘中估值突破报警线，触发 iOS 紧急警报通知（绕过静音模式）。
    *   **实时活动 (Live Activities)**：报警触发后，锁屏界面常驻显示该基金的实时波动状态，直至用户处理。

### 2.4 对账监控联动 (Reconciliation Sync)
*   **需求描述**：每日官方净值公布后，自动核对推算误差。
*   **关键特性**：
    *   **误差校准**：每天 20:00 自动请求后端 `reconcile_valuations.py` 逻辑，展示“推算 vs 官方”误差曲线。
    *   **状态反馈**：若误差连续 3 天超过 0.5%，在 Tab 4 上显示红色告警，提示需要检查持仓数据源。

---

## 3. UI/UX 视觉需求 (Design Specifications)

### 3.1 材质与交互
*   **视觉语言**：Liquid Glass (液态玻璃) 材质。
*   **渲染要求**：
    *   主界面滚动必须保持 120 FPS (ProMotion 适配)。
    *   基金卡片背景应用 `MeshGradient` 动态流体，颜色随 Urgency Score 变化。
*   **手势逻辑**：
    *   双指缩放图表，单指长按触发十字准星交互。
    *   右滑加入 Watchlist，左滑一键发起策略回测。

### 3.2 灵动岛适配 (Dynamic Island)
*   当用户将 App 置于后台时，若有已开启实时监控的基金，灵动岛应展示：`[基金名] [实时涨跌幅] [波动波形]`。

---

## 4. 非功能性需求 (Non-Functional Requirements)

*   **性能控制**：后台 SSE 订阅需在进入后台 30 秒后自动降级为低频拉取或关闭，以优化功耗。
*   **安全性**：所有资产配比信息、预警线设置必须加密存储于 iOS Keychain。
*   **离线能力**：使用 SwiftData 实现全功能缓存，支持在无网络时查阅最后一次同步的持仓与归因分析。

---

## 5. 测试需求 (Testing & QA)

### 5.1 单元测试 (Unit Testing)
*   **Valuation Logic**：验证估值计算函数在处理极端价格（如 0 或空值）时的稳定性。
*   **Volatility Engine**：输入 30 天模拟数据，验证 $2\sigma$ 计算结果与后端 Python 逻辑一致性。

### 5.2 性能测试 (Performance Testing)
*   **Frame Rate**：在 iPhone 15 Pro/16 Pro 上验证开启 10 只基金实时估值时，主界面不掉帧（稳定 120 FPS）。
*   **Memory Leak**：检查大量 SSE 数据流入时，`AsyncStream` 是否存在内存泄露。

### 5.3 业务测试 (UAT)
*   **Alarm Accuracy**：模拟资产价格暴跌，验证报警推送的延迟是否在 2 秒以内。
*   **Linkage Verification**：验证点击关联情报卡片是否能准确跳转到“黄金跟踪”模块对应的详情。

---

## 6. 开发计划 (Roadmap)
*   **Phase 1**: 搭建 `FeatureAlphaFund` 模块架构与数据模型 (SwiftData)。
*   **Phase 2**: 实现基于 Actor 的实时估值计算引擎与 SSE 连接。
*   **Phase 3**: 开发液态玻璃 UI 详情页与 Swift Charts 归因视图。
*   **Phase 4**: 集成 2σ 智能报警系统与灵动岛推送。
*   **Phase 5**: 跨模块联调（关联情报注入）与性能验收。
